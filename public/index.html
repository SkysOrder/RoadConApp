<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script>
        /*$("#frameAp").load(function () {
            console.log($('#frameAp').contents().find(".infowindow-image").html());
        });*/
        $(document).ready(function () {
            //var imgSRc = "";
            /*("#frameAp").onload = function () {
                var win = $("#frameAp").contentWindow;
                var doc = $("#frameAp").contentDocument ? $("#frameAp").contentDocument.document : $("#frameAp").contentWindow.document;
                var form = doc.getElementByClass("infowindow-image");
                var imgSrc = form.attr("src");
                console.log(imgSrc);
                var win = $("#frameAp").contentWindow;
                var imgSRc = win.$(".infowindow-image").attr("src");
                console.log(imgSRc);
            };*/
            var sttr = "https://api.data.gov.sg/v1/transport/traffic-images?date_time="
            var d = new Date($.now());
            var DTMS = d.getFullYear() + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2) + "T" + ("0" + d.getHours()).slice(-2) + "%3A" + ("0" + d.getMinutes()).slice(-2) + "%3A" + ("0" + d.getSeconds()).slice(-2);
            var apiCl = sttr + DTMS;

            $.getJSON(apiCl, function (data) {
                var items = [];
                $.each(data, function (key, val) {
                    $.each(val, function (ka, vla) {
                        $.each(vla, function (ka1, vla1) {
                            console.log(ka1);
                            console.log(vla1);
                            items.push(vla1);
                            $.each(val, function (kar1, var1) {
                                console.log(kar1);
                                console.log(var1);
                                itemArr = [items[1]];
                                console.log(itemArr[0]);
                                ArrIt = [itemArr[0]];
                                console.log(ArrIt[0]);
                            });
                        });
                    });
                });
            });
            $("#ckBtn").click(function () {
                //var imagSrcs = $("#frameAp").contentDocument;
                //var imagSrc = $("#frameAp").contentDocument.body.$(".infowindow-image").attr("src");
                //var imagSrc = $(".infowindow-image").attr("src");
                //alert(imagSrc);
                var x = document.getElementById("frameAp");
                var y = x.contentDocument || x.contentWindow.document;
                //var imagSrc = x.$(".infowindow-image").attr("src");
                console.log(y);
         
                $("#ImgCh img").attr("src", "https://images.data.gov.sg/api/traffic-images/2018/11/8cdf6cbd-1a22-48d9-8f13-60e9f643c92d.jpg");
                console.log(imagSrc);
            });
        });

    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Real Time Traffic Congestion App</title>

    <!-- Use the maxcdn network to get Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
          crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="stylesheets/base.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
</head>

  <body>
    <section id="intro" class="container">
      <div class="row" style="padding-top: 8%;">
 
        <div class="col-sm-offset-1 col-sm-7">
          <h1>Real Time Road Congestion App</h1>
        </div>
      </div>
      <div class="row">
        <hr class="col-sm-offset-1 col-sm-10 blue"/>
      </div>
      <div class="row">
        <form class="form-horizontal" role="form" id="registration-form">
            <div class="controls">
                <p class="col-sm-offset-4 col-sm-8 blue"
                   style="font-weight: bold; font-size: 115%;">
                    Click to show congestion level.
                </p>
                <div class="row">
                    <div class="col-sm-6 col-sm-6">
                        <iframe id="frameAp" style="cursor:pointer;" width="600" height="400" src="https://data.gov.sg/dataset/traffic-images/resource/e127e29a-bd48-47e2-a0a7-e89ce31f10c7/view/39ba8de0-6242-40d3-8664-793316c47b09" frameBorder="0" ></iframe>
                    </div>
                    <div class="col-sm-6 col-sm-6">
                        <div id="ImgCh">
                            <img id="CongestImg" src="..\Images\58898400_p0.png" alt="Test Image" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-4 col-sm-8">
                            <div class="btn btn-lg" id="ckBtn"
                                    style="border: none; background-color: #00aed1; font-weight: bold;">
                                Check
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
      </div>
    </section>
  </body>
</html>
